b.innerHTML="<center><font face=arial><p><button onclick=p=g=s=1;m=[];c=1;d=e=f=3;a()>XnO<button onclick=p=g=s=1;m=[];c=d=e=f=3;a()>XnO3D<button onclick=p=g=s=1;m=[];c=1;d=6;e=7;f=4;a()>Find4<button onclick=p=g=s=1;m=[];c=1;d=8;e=8;f=w=0;m[27]=m[36]=-1;m[28]=m[35]=1;a()>Flip</button><p id=z>";a=function(n,r,x){l=0;h="";for(i=c;h+="</table><br><table border>",i--;)for(j=d;j--;)for(h+="<tr>",k=e;k--;)h+="<th width=20 onclick=q("+[l,7-j,7-k]+") id=t"+l+"> "+"X.O"[1+(m[l]=m[l++]||0)];z.innerHTML=h+(g?~m.indexOf(0)?"XnO"[p+1]+" next":f?"draw":"":f?"XnO"[-p+1]+" won":"")+(f?"":"<br>"+(w?0<w?"O>X":"X>O":"X=O")+"<br><button onclick=p=-p;a()>pass")};q=function(n,r,x){if(g&&!m[n]){if(3<f){for(;35>n&&!m[n+7];n+=7);for(i=6;i--;)for(j=7;j--;)if(k=7*i+j,~[4>j&&m[k]+m[k+1]+m[k+2]+m[k+3],3>i&&m[k]+m[k+7]+m[k+14]+m[k+21],3>i&&4>j&&m[k]+m[k+8]+m[k+16]+m[k+24],3>i&&2<j&&m[k]+m[k+6]+m[k+12]+m[k+18]].indexOf(f*(m[n]=p)))g=0}else if(f)for(i=3;i--;)for(j=3;j--;){if(k=9*i,l=3*j,~[m[k+j]+m[k+j+3]+m[k+j+6],m[k+l]+m[k+l+1]+m[k+l+2],m[k+4]+m[k+0]+m[k+8],m[k+4]+m[k+2]+m[k+6],m[l+10]+m[l]+m[l+20],m[l+10]+m[l+2]+m[l+18],m[i+12]+m[i]+m[i+24],m[i+12]+m[i+6]+m[i+18],m[13]+m[0]+m[26],m[13]+m[2]+m[24],m[13]+m[6]+m[20],m[13]+m[8]+m[18],m[l+i]+m[l+i+9]+m[l+i+18]].indexOf(f*(m[n]=p)))g=0}else{s=0;for(i=2;~i--;)for(j=2;~j--;)if(i|j&&(t=0,m[8*(r+i)+x+j]==-p)){k=r+i;for(l=x+j;~k&&9>k&&~l&&9>l;k+=i,l+=j){if(m[8*k+l]==p){s=t=1;break}if(!m[8*k+l])break}if(t)for(u=r,v=x;u!=k||v!=l;u+=i,v+=j)m[8*u+v]=p}w=0;for(i in m)w+=m[i]}s&&(p=-p);a()}}